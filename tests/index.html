<html>
  <head>
    <title>My first Three.js app</title>
    <style>canvas { width: 100%; height: 100% }</style>
  </head>
  <body>
    <script src="lib/three.min.js"></script>
    <script src="lib/PointerLockControls.js"></script>
    <script src="lib/THREEx.FullScreen.js"></script>
    	<div id="blocker">

			<div id="instructions">
				<span style="font-size:40px">Click to play</span>
				<br />
				(W, A, S, D = Move, SPACE = Jump, MOUSE = Look around)
			</div>

		</div>
    <script>

   	   var blocker = document.getElementById( 'blocker' );
			var instructions = document.getElementById( 'instructions' );

			// http://www.html5rocks.com/en/tutorials/pointerlock/intro/

			var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;

			if ( havePointerLock ) {

				var element = document.body;

				var pointerlockchange = function ( event ) {

					if ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {

						controls.enabled = true;

						blocker.style.display = 'none';

					} else {

						controls.enabled = false;

						blocker.style.display = '-webkit-box';
						blocker.style.display = '-moz-box';
						blocker.style.display = 'box';

						instructions.style.display = '';

					}

				}

				var pointerlockerror = function ( event ) {

					instructions.style.display = '';

				}

				// Hook pointer lock state change events
				document.addEventListener( 'pointerlockchange', pointerlockchange, false );
				document.addEventListener( 'mozpointerlockchange', pointerlockchange, false );
				document.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );

				document.addEventListener( 'pointerlockerror', pointerlockerror, false );
				document.addEventListener( 'mozpointerlockerror', pointerlockerror, false );
				document.addEventListener( 'webkitpointerlockerror', pointerlockerror, false );

				instructions.addEventListener( 'click', function ( event ) {

					instructions.style.display = 'none';

					// Ask the browser to lock the pointer
					element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;

					if ( /Firefox/i.test( navigator.userAgent ) ) {

						var fullscreenchange = function ( event ) {

							if ( document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element ) {

								document.removeEventListener( 'fullscreenchange', fullscreenchange );
								document.removeEventListener( 'mozfullscreenchange', fullscreenchange );

								element.requestPointerLock();
							}

						}

						document.addEventListener( 'fullscreenchange', fullscreenchange, false );
						document.addEventListener( 'mozfullscreenchange', fullscreenchange, false );

						element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;

						element.requestFullscreen();

					} else {

						element.requestPointerLock();

					}

				}, false );

			} else {

				instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API';

			}


    </script>
    <script>
     //document.body.addEventListener("keydown", function() {THREEx.FullScreen.request();}, false);
     var clock = new THREE.Clock();
     //Scene, camera renderer
     var scene = new THREE.Scene();
     var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
     var renderer = new THREE.WebGLRenderer();
     renderer.setSize(window.innerWidth, window.innerHeight);
     document.body.appendChild(renderer.domElement);
     //camera.position.z =400 ;

     //Resize
     window.addEventListener( 'resize', onWindowResize, false );
     
     //A plane, with tiling texture
     var texture = THREE.ImageUtils.loadTexture('grass.png');
     texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
     texture.repeat.set(5, 5);
     texture.magFilter = THREE.NearestFilter;
     texture.minFilter = THREE.LinearMipMapLinearFilter;
     var plane = new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000), new THREE.MeshLambertMaterial({ map: texture, ambient: 0xbbbbbb }));
     plane.overdraw=true;
     plane.rotation.x = -Math.PI/2;
     scene.add(plane);

     //A js model exported from blender
     var loader = new THREE.JSONLoader();
     loader.load( "blender/monkey.js", function( geometry ) {

       mesh = new THREE.Mesh( geometry, new THREE.MeshNormalMaterial() );
       mesh.scale.set( 10, 10, 10 );
       mesh.position.y = 0;
       mesh.position.x = 0;
       scene.add( mesh );
     } );
     
     //Some light
     var ambientLight = new THREE.AmbientLight(0xbbbbbb);
     scene.add(ambientLight);

     //Camera control
     var camControls = new THREE.PointerLockControls(camera);
     scene.add(camControls.getObject());
     
     var render = function () {
       requestAnimationFrame(render);
       camControls.enabled=true;
       camControls.isOnObject( false );
       camControls.update();

       renderer.render(scene, camera);
     };

     function animate()
     {
       
     }
     render();
     
     function onWindowResize() {

       camera.aspect = window.innerWidth / window.innerHeight;
       camera.updateProjectionMatrix();

       renderer.setSize( window.innerWidth, window.innerHeight );

     }
    </script>
  </body>
</html>
